---
title: "ì¸êµ¬ê·¸ë˜í”„"
subtitle: "í˜„ì¬ ê·¸ë¦¬ê³  ë¯¸ë˜ ìš°ë¦¬ë‚˜ë¼ì˜ ì¸êµ¬ ë™í–¥ ì•Œì•„ë³´ê¸°"
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
# í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
suppressPackageStartupMessages({
  library(dplyr)
  library(ggplot2)
  library(tidyr)
  library(plotly)
  library(tidyverse)
  library(stringr)
  library(readr)
})
```

## ì¸êµ¬ ê·¸ë˜í”„

::: {.panel-tabset}

### ì¸êµ¬í”¼ë¼ë¯¸ë“œ

```{r echo=FALSE, message=FALSE, warning=FALSE}
#| fig-width: 10
#| fig-height: 7

# 1) CSV ì½ê¸° (KOSIS/Excel ì €ì¥ë³¸ì€ CP949ì¼ ê°€ëŠ¥ì„±ì´ í¼)
path <- "ì„±_ë°_ì—°ë ¹ë³„_ì¶”ê³„ì¸êµ¬_1ì„¸ë³„__5ì„¸ë³„____ì „êµ­_20251105141310.csv"
df <- read.csv(path, fileEncoding = "CP949", check.names = FALSE)

# 2) ëª¨ë“  ì—´ ì´ë¦„ì„ ë¬¸ìì—´ë¡œ ê°•ì œ ë³€í™˜ (ì¤‘ìš”!)
names(df) <- as.character(names(df))

# 3) ì—°ë„ ì»¬ëŸ¼ ì°¾ê¸°
year_cols <- names(df)[grepl("^[0-9]{4}$", names(df))]
meta_cols <- setdiff(names(df), year_cols)

# 4) Long ë³€í™˜ (ì´ì œ í˜• ì¼ê´€ì„± ë³´ì¥)
long <- df |>
  mutate(across(all_of(year_cols), as.character)) |>  # <- ëª¨ë“  ì—°ë„ ì—´ì„ ë¬¸ìë¡œ í†µì¼
  pivot_longer(all_of(year_cols), names_to = "year", values_to = "pop") |>
  mutate(year = as.integer(year))

# 5) ì‹œë‚˜ë¦¬ì˜¤/ì„±ë³„ í•„í„° (ì¤‘ìœ„ ì¶”ê³„ + ë‚¨/ì—¬ë§Œ ì‚¬ìš©)
long <- long |>
  filter(grepl("ì¤‘ìœ„", .data[["ê°€ì •ë³„"]])) |>
  filter(.data[["ì„±ë³„"]] %in% c("ë‚¨ì","ì—¬ì"))

# 6) ì—°ë ¹ ë ˆë²¨ ì •ë ¬(ì´ê³„ 'ê³„' ì œê±°, ì• ìˆ«ìë¡œ ì •ë ¬)
age_levels <- long |>
  filter(ì—°ë ¹ë³„ != "ê³„") |>
  distinct(ì—°ë ¹ë³„) |>
  mutate(key = suppressWarnings(as.integer(sub(" .*","", ì—°ë ¹ë³„)))) |>
  arrange(key) |>
  pull(ì—°ë ¹ë³„)

long <- long |>
  filter(ì—°ë ¹ë³„ != "ê³„") |>
  mutate(
    ì—°ë ¹ë³„ = factor(ì—°ë ¹ë³„, levels = age_levels),
    pop = as.numeric(pop),
    pop_plot = ifelse(ì„±ë³„ == "ë‚¨ì", -pop, pop)
  )

# 7) ë‹¨ìœ„ ë¼ë²¨
unit_label <- if ("ë‹¨ìœ„" %in% names(df)) df$ë‹¨ìœ„[1] else "ëª…"

# 8) Plotly ì• ë‹ˆë©”ì´ì…˜ ìƒì„±
plot_ly() |>
  add_bars(
    data = long |> filter(ì„±ë³„ == "ë‚¨ì"),
    x = ~pop_plot, y = ~ì—°ë ¹ë³„, frame = ~year,
    orientation = "h", name = "ë‚¨ì",
    marker = list(color = "#5B9BD5"),
    text = ~format(abs(pop_plot), big.mark = ","),
    customdata = ~year,
    hovertemplate = "ì—°ë„: %{customdata}<br>ì—°ë ¹: %{y}<br>ë‚¨ì: %{text}<extra></extra>"
  ) |>
  add_bars(
    data = long |> filter(ì„±ë³„ == "ì—¬ì"),
    x = ~pop_plot, y = ~ì—°ë ¹ë³„, frame = ~year,
    orientation = "h", name = "ì—¬ì",
    marker = list(color = "#ED7D31"),
    text = ~format(abs(pop_plot), big.mark = ","),
    customdata = ~year,
    hovertemplate = "ì—°ë„: %{customdata}<br>ì—°ë ¹: %{y}<br>ì—¬ì: %{text}<extra></extra>"
  ) |>
  layout(
    title = list(
      text = "<b>ì¸êµ¬í”¼ë¼ë¯¸ë“œ</b>",
      font = list(size = 18, family = "Malgun Gothic")
    ),
    barmode = "overlay",
    xaxis = list(
      title = paste0("ì¸êµ¬ìˆ˜ (", unit_label, ")"), 
      tickformat = ",d",
      gridcolor = 'rgba(200,200,200,0.3)'
    ),
    yaxis = list(
      title = "ì—°ë ¹ëŒ€",
      gridcolor = 'rgba(200,200,200,0.3)'
    ),
    font = list(family = "Malgun Gothic, sans-serif", size = 10),
    legend = list(
      orientation = "h", 
      x = 0.35, 
      y = -0.15
    ),
    margin = list(l = 80, r = 50, t = 80, b = 100)
  ) |>
  animation_opts(
    frame = 300, 
    transition = 0, 
    easing = "linear", 
    redraw = FALSE
  ) |>
  animation_slider(
    currentvalue = list(
      prefix = "ì—°ë„: ",
      font = list(size = 14)
    )
  ) |>
  config(displayModeBar = TRUE, locale = 'ko')
```

### ì¸êµ¬ì„±ì¥ë¥  ì¶”ì´

```{r echo=FALSE, message=FALSE, warning=FALSE}
#| fig-width: 10
#| fig-height: 7

path2 <- "ì£¼ìš”_ì¸êµ¬ì§€í‘œ_ì„±ë¹„_ì¸êµ¬ì„±ì¥ë¥ _ì¸êµ¬êµ¬ì¡°_ë¶€ì–‘ë¹„_ë“±____ì „êµ­_20251107085649.csv"
df2 <- read.csv(path2, fileEncoding = "CP949", check.names = FALSE)

year_cols <- names(df2)[grepl("^[0-9]{4}$", names(df2))]
growth <- df2 |>
  filter(str_detect(df2[["ì¸êµ¬êµ¬ì¡°,ë¶€ì–‘ë¹„ë³„"]], "ì¸êµ¬ì„±ì¥ë¥ ")) |>
  pivot_longer(
    all_of(year_cols),
    names_to = "ì—°ë„",
    values_to = "ì„±ì¥ë¥ "
  ) |>
  mutate(
    ì—°ë„ = as.integer(ì—°ë„),
    ì„±ì¥ë¥  = as.numeric(ì„±ì¥ë¥ )
  )

plot_ly(
  data = growth,
  x = ~ì—°ë„, 
  y = ~ì„±ì¥ë¥ ,
  type = "scatter", 
  mode = "lines+markers",
  line = list(color = "#2BB3B8", width = 3),
  marker = list(color = "#2BB3B8", size = 7),
  hovertemplate = "ì—°ë„: %{x}<br>ì¸êµ¬ì„±ì¥ë¥ : %{y}%<extra></extra>"
) |>
  layout(
    title = list(
      text = "<b>ì¸êµ¬ì„±ì¥ë¥  ì¶”ì´</b>",
      font = list(size = 18, family = "Malgun Gothic")
    ),
    xaxis = list(
      title = "ì—°ë„", 
      rangeslider = list(visible = TRUE),
      gridcolor = 'rgba(200,200,200,0.3)'
    ),
    yaxis = list(
      title = "ì¸êµ¬ì„±ì¥ë¥ (%)", 
      fixedrange = FALSE,
      gridcolor = 'rgba(200,200,200,0.3)',
      zeroline = TRUE,
      zerolinecolor = 'rgba(0,0,0,0.5)',
      zerolinewidth = 1
    ),
    hovermode = "x unified",
    font = list(family = "Malgun Gothic, sans-serif", size = 10),
    plot_bgcolor = 'rgba(240,240,240,0.3)',
    paper_bgcolor = 'white',
    margin = list(l = 60, r = 50, t = 80, b = 120)
  ) |>
  config(displayModeBar = TRUE, locale = 'ko')
```

### ì—°ë ¹ê³„ì¸µë³„ ì¸êµ¬êµ¬ì¡°

```{r echo=FALSE, message=FALSE, warning=FALSE}
#| fig-width: 10
#| fig-height: 7

pop_raw <- read_csv(
  "ì£¼ìš”_ì¸êµ¬ì§€í‘œ_ì„±ë¹„_ì¸êµ¬ì„±ì¥ë¥ _ì¸êµ¬êµ¬ì¡°_ë¶€ì–‘ë¹„_ë“±____ì „êµ­_20251118150417.csv",
  locale = locale(encoding = "CP949")
)

age_long <- pop_raw |>
  filter(`ì¸êµ¬êµ¬ì¡°,ë¶€ì–‘ë¹„ë³„` %in% c(
    "- êµ¬ì„±ë¹„(%): 0-14ì„¸",
    "- êµ¬ì„±ë¹„(%): 15-64ì„¸",
    "- êµ¬ì„±ë¹„(%): 65ì„¸ ì´ìƒ"
  )) |>
  pivot_longer(
    cols = `1961`:`2072`,
    names_to = "year",
    values_to = "ratio"
  ) |>
  mutate(
    year = as.integer(year),
    ì—°ë ¹ê³„ì¸µ = case_when(
      `ì¸êµ¬êµ¬ì¡°,ë¶€ì–‘ë¹„ë³„` == "- êµ¬ì„±ë¹„(%): 0-14ì„¸" ~ "0-14ì„¸ ìœ ì†Œë…„ì¸êµ¬",
      `ì¸êµ¬êµ¬ì¡°,ë¶€ì–‘ë¹„ë³„` == "- êµ¬ì„±ë¹„(%): 15-64ì„¸" ~ "15-64ì„¸ ìƒì‚°ì—°ë ¹ì¸êµ¬",
      `ì¸êµ¬êµ¬ì¡°,ë¶€ì–‘ë¹„ë³„` == "- êµ¬ì„±ë¹„(%): 65ì„¸ ì´ìƒ" ~ "65ì„¸ ì´ìƒ ê³ ë ¹ì¸êµ¬"
    ),
    ì—°ë ¹ê³„ì¸µ = factor(
      ì—°ë ¹ê³„ì¸µ,
      levels = c(
        "0-14ì„¸ ìœ ì†Œë…„ì¸êµ¬",
        "15-64ì„¸ ìƒì‚°ì—°ë ¹ì¸êµ¬",
        "65ì„¸ ì´ìƒ ê³ ë ¹ì¸êµ¬"
      )
    )
  )

plot_ly(
  data = age_long,
  x = ~year,
  y = ~ratio,
  color = ~ì—°ë ¹ê³„ì¸µ,
  colors = c("#134981", "#FFEABC", "#FBC5F9"),
  type = "bar",
  hovertemplate = "ì—°ë„: %{x}<br>%{fullData.name}: %{y}%<extra></extra>"
) |>
  layout(
    title = list(
      text = "<b>ì—°ë ¹ê³„ì¸µë³„ ì¸êµ¬êµ¬ì¡° ê·¸ë˜í”„</b>",
      font = list(size = 18, family = "Malgun Gothic")
    ),
    barmode = "stack",
    xaxis = list(
      title = "ì—°ë„",
      rangeslider = list(visible = TRUE),
      gridcolor = 'rgba(200,200,200,0.3)'
    ),
    yaxis = list(
      title = "êµ¬ì„±ë¹„(%)",
      range = c(0, 100),
      gridcolor = 'rgba(200,200,200,0.3)'
    ),
    font = list(family = "Malgun Gothic, sans-serif", size = 10),
    legend = list(
      orientation = "h",
      x = 0.2,
      y = -0.2,
      font = list(size = 10)
    ),
    plot_bgcolor = 'rgba(240,240,240,0.3)',
    paper_bgcolor = 'white',
    margin = list(l = 60, r = 50, t = 80, b = 120)
  ) |>
  config(displayModeBar = TRUE, locale = 'ko')
```

:::

---



## ìš°ë¦¬ë‚˜ë¼ ìƒì‚°ê°€ëŠ¥ì¸êµ¬ ì „ë§ ì¶”ì´

```{r}

# 1. ë°ì´í„° íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
# íŒŒì¼ ê²½ë¡œëŠ” ì‚¬ìš©ìì˜ í™˜ê²½ì— ë§ê²Œ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
population_data_raw <- read_csv(
  "ì£¼ìš”_ì—°ë ¹ê³„ì¸µë³„_ì¶”ê³„ì¸êµ¬_ìƒì‚°ì—°ë ¹ì¸êµ¬__ê³ ë ¹ì¸êµ¬_ë“±____ì „êµ­_20251208184446.csv", 
  locale = locale(encoding = "euc-kr")
)

# 2. ë°ì´í„° ì „ì²˜ë¦¬
population_data_processed <- population_data_raw %>%
  # 'ì¸êµ¬ì¢…ë¥˜ë³„' ì—´ì—ì„œ ìƒì‚°ì—°ë ¹ì¸êµ¬ ë°ì´í„°ë§Œ í•„í„°ë§
  filter(`ì¸êµ¬ì¢…ë¥˜ë³„` == "ìƒì‚°ì—°ë ¹ì¸êµ¬(ì²œëª…): ê³„(15~64ì„¸)") %>%
  # 'ê°€ì •ë³„' ì—´ê³¼ 'ì¸êµ¬ì¢…ë¥˜ë³„' ì—´ì„ ì œì™¸í•˜ê³ , ì—°ë„ì™€ ì¸êµ¬ ë°ì´í„°ë¥¼ ê¸´ í˜•ì‹ìœ¼ë¡œ ë³€í™˜
  pivot_longer(
    cols = `2015`:`2050`,
    names_to = "ì—°ë„",
    values_to = "ìƒì‚°ê°€ëŠ¥ì¸êµ¬" # ë‹¨ìœ„: ì²œëª…
  ) %>%
  # 'ì—°ë„'ë¥¼ ìˆ«ìë¡œ ë³€í™˜
  mutate(ì—°ë„ = as.numeric(ì—°ë„)) %>%
  # ì—°ë„ 5ë…„ ê°„ê²©ìœ¼ë¡œ ìƒ˜í”Œë§ (ê¸°ì¡´ ì½”ë“œì™€ í†µì¼ì„±ì„ ìœ„í•´)
  # ì›ë³¸ ë°ì´í„°ëŠ” ë§¤ë…„ ë°ì´í„°ê°€ ìˆìœ¼ë¯€ë¡œ, í•„ìš”í•˜ë‹¤ë©´ ì´ í•„í„°ë¥¼ ì œê±°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  filter(ì—°ë„ %% 5 == 0 | ì—°ë„ == 2015 | ì—°ë„ == 2050) %>%
  # 'ìƒì‚°ê°€ëŠ¥ì¸êµ¬'ì˜ NA ê°’ ì œê±° (ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„)
  drop_na(ìƒì‚°ê°€ëŠ¥ì¸êµ¬)

# 3. ê·¸ë˜í”„ ìƒì„±
# ì›ë³¸ ì½”ë“œì˜ ì£¼ì„ ì²˜ë¦¬ëœ ê³„ì‚°ì„ ìœ„í•´ í•„ìš”í•œ ê°’ ì¶”ì¶œ
start_population <- population_data_processed %>% filter(ì—°ë„ == 2015) %>% pull(ìƒì‚°ê°€ëŠ¥ì¸êµ¬)
end_population <- population_data_processed %>% filter(ì—°ë„ == 2050) %>% pull(ìƒì‚°ê°€ëŠ¥ì¸êµ¬)
# ê°ì†Œìœ¨ ê³„ì‚°
decrease_rate <- round((start_population - end_population) / start_population * 100)

plot_ly(population_data_processed,
        x = ~ì—°ë„,
        y = ~ìƒì‚°ê°€ëŠ¥ì¸êµ¬,
        type = 'scatter',
        mode = 'lines+markers',
        fill = 'tozeroy',
        fillcolor = 'rgba(255, 0, 0, 0.1)',
        line = list(color = 'red', width = 3),
        marker = list(size = 10, color = 'red')) %>%
  layout(
    title = list(text = 'ëŒ€í•œë¯¼êµ­ ìƒì‚°ê°€ëŠ¥ì¸êµ¬ ì „ë§ (2015-2050)', font = list(size = 16)),
    xaxis = list(title = 'ì—°ë„'),
    yaxis = list(title = 'ì¸êµ¬ (ì²œëª…)'),
    hovermode = 'x unified'
  )
```

```{r}
#| echo: false

decrease_2050 <- ((24890 - 37040) / 37040) * 100
decrease_amount <- 37040 - 24890
```
---



## ìƒê°í•´ë³´ê¸°ğŸ¤” 

::: {.panel-tabset}

### ì§ˆë¬¸ 1
**2035ë…„ ìš°ë¦¬ë‚˜ë¼ ê²½ì œí™œë™ì¸êµ¬ì˜ í‰ê·  ë‚˜ì´ëŠ” ì–´ë–»ê²Œ ë ê¹Œìš”?**

KOSIS í¬í„¸ ì†ì—ì„œ ë‹µì„ ì°¾ì•„ë´…ì‹œë‹¤.:
<textarea style="width:100%; height:100px; padding:10px; border:2px solid #ddd; border-radius:5px;" placeholder="2035ë…„ ìš°ë¦¬ë‚˜ë¼ ê²½ì œí™œë™ì¸êµ¬ì˜ í‰ê·  ë‚˜ì´ëŠ”..."></textarea>


:::

---

